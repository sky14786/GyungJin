<!DOCTYPE html>
<html lang="en">
  <head>
    <title>경진 ERP</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/jquery_cookie.js"></script>
  </head>
  <body>
    <script>
      $(document).ready(function() {
        $("#header").load("../common/header.html?ver=20200306");
      });
    </script>

    <style>
      .container-fluid {
        font-family: "Noto Sans KR", sans-serif;
      }
    </style>
    <div id="header"></div>
    <div class="container-fluid" style="margin-top: 1%">
      <table class="table">
        <thead class="thead-light">
          <tr style="text-align:center;">
            <th>거래처번호</th>
            <th>거래처명</th>
            <th>담당자</th>
            <th>연락처</th>
            <th>종류</th>
            <th>등록일</th>
            <th>상세정보</th>
          </tr>
        </thead>
        <tbody id="tbody" style="text-align: center;">
          <!-- <tr style="text-align:center;">
            <td>
              <a href="#" style="color:inherit;"></a>
            </td>

            <td></td>
            <td></td>

            <td></td>

            <td></td>
            <td>
              <button
                type="button"
                class="btn btn-sm"
                style="background-color:#17a2b8;color:white;"
              >
                <a href="#" style="color:inherit;">
                  수정
                </a>
              </button>
              <button
                type="button"
                name="btn_del"
                class="btn btn-sm"
                style="background-color:#17a2b8;color:white;"
              >
                삭제
              </button>

              <button
                type="button"
                name="btn_report"
                class="btn btn-sm"
                style="background-color:#17a2b8;color:white;"
              >
                경고
              </button>
            </td>
          </tr> -->
        </tbody>
      </table>
      <div id="pageBar" style="text-align:center;color:black;"></div>
    </div>
  </body>
  <script>
    $(document).ready(function() {
      loadClient();
    });

    var clientCategory;

    function loadClient() {
      $.ajax({
        url: "/api/client",
        method: "GET",
        dataType: "json",
        contentType: "application/json; charset=UTF-8",
        success: function(data) {
          clientCategory = loadClientCategory();
          $.each(data, function(index, item) {
            createRow(item);
          });
        },
        error: function(request, status, error) {
          ajaxError(request, status, error);
        }
      });
    }

    function createRow(item) {
      var tbody = $("#tbody");
      var tr = $("<tr>");

      $(tr).append($("<td>").text(item.clientCode));
      $(tr).append($("<td>").text(item.clientName));
      $(tr).append($("<td>").text(item.clientCustomer));
      $(tr).append($("<td>").text(item.clientTel));

      // temp = loadClientCategory();
      // console.log(clientCategory);
      $.each(clientCategory, function(index, result) {
        if (result.clientCateCode == item.clientCategory) {
          $(tr).append($("<td>").text(result.clientCateName));
        }
      });

      $(tr).append(
        $("<td>").text(
          item.regDate.year +
            "-" +
            item.regDate.monthValue +
            "-" +
            item.regDate.dayOfMonth +
            " / " +
            item.regDate.hour +
            "시 " +
            item.regDate.minute +
            "분"
        )
      );

      var td = $("<td>");
      $(td).append(
        $("<button>")
          .attr("class", "btn btn-sm")
          .attr("type", "button")
          .css({
            "background-color": "#17a2b8",
            color: "white"
          })
          .text("수정")
      );
      $(td).append(
        $("<button>")
          .attr("class", "btn btn-sm")
          .attr("type", "button")
          .attr("onclick", "deleteClient(this)")
          .css({
            "background-color": "#17a2b8",
            color: "white",
            "margin-left": "10px"
          })
          .text("삭제")
      );

      $(tr).append(td);

      $(tbody).append(tr);
    }

    function deleteClient(item) {
      var index = $(item)
        .parent()
        .parent()
        .children()[0];
      $.ajax({
        url: "/api/client/" + $(index).text(),
        method: "DELETE",
        dataType: "text",
        contentType: "application/json; charset=UTF-8",
        success: function(data) {
          if (data == "true") {
            alert("삭제되었습니다.");
          } else {
            alert("삭제 실패!");
          }
        },
        erorr: function(request, status, error) {
          ajaxError(request, status, error);
        },
        beforeSend: function() {
          loadingDisplayOn();
        },
        complete: function() {
          loadingDisplayOff();
          $(location).attr("href", $(location).attr("href"));
        }
      });
    }
  </script>

  <style>
    #pageBar > a {
      color: black !important;
      margin: 4px !important;
      font-size: 20px;
    }
    #pageBar > .cPage {
      margin: 4px !important;
      color: grey !important;
      font-size: 22px;
    }
    .list-padding {
      padding: 10px 5px;
    }
  </style>
</html>
